
/* Drop Tables */

DROP TABLE IF EXISTS CONFIG_GROUP_PANELS;
DROP TABLE IF EXISTS EVENT_MEDIA;
DROP TABLE IF EXISTS EVENT;
DROP TABLE IF EXISTS PANEL_MEDIA;
DROP TABLE IF EXISTS MEDIA;
DROP TABLE IF EXISTS PANEL;
DROP TABLE IF EXISTS PLACE;




/* Create Tables */

CREATE TABLE CONFIG_GROUP_PANELS
(
	-- id do painel agrupador dos eventos.
	MASTER_PANEL_ID BIGINT NOT NULL,
	-- id do painel que será agrupado.
	NORMAL_PANEL_ID BIGINT NOT NULL
) WITHOUT OIDS;


CREATE TABLE EVENT
(
	ID BIGINT NOT NULL,
	NAME VARCHAR,
	PLACE_ID BIGINT NOT NULL,
	TYPE VARCHAR,
	DESCRIPTION VARCHAR,
	PICTURE TEXT,
	INITIAL_DATE TIMESTAMP,
	INITIAL_HOUR TIMESTAMP,
	FINAL_DATE TIMESTAMP,
	FINAL_HOUR TIMESTAMP,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE EVENT_MEDIA
(
	ID BIGINT NOT NULL,
	EVENT_ID BIGINT NOT NULL,
	MEDIA_ID BIGINT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE MEDIA
(
	ID BIGINT NOT NULL,
	-- Quando se tratar de uma imagem será guardado o encode base 64
	CONTENT TEXT NOT NULL,
	DESCRIPTION VARCHAR,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PANEL
(
	ID BIGINT NOT NULL,
	PLACE_ID BIGINT NOT NULL,
	CODE VARCHAR,
	NAME VARCHAR,
	DESCRIPTION VARCHAR,
	TYPE VARCHAR,
	-- onde o painel está instalado. Pode ser uma sala, salão, corredor, etc.
	-- 
	ADDRESS VARCHAR,
	-- tempo em segundos para exibição das midias associadas ao painel. ver configuração.
	ENDOMARKETING_TIME BIGINT DEFAULT 600 NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


CREATE TABLE PANEL_MEDIA
(
	ID INT NOT NULL,
	PANEL_ID BIGINT NOT NULL,
	MIDIA_ID BIGINT NOT NULL,
	PRIMARY KEY (ID)
) WITHOUT OIDS;


-- Entenda por area uma area, um corredor, um balcao, etc
CREATE TABLE PLACE
(
	ID BIGINT NOT NULL,
	-- exemplo VENEZIA 1
	NAME VARCHAR,
	ADDRESS VARCHAR,
	DESCRIPTION VARCHAR,
	PRIMARY KEY (ID)
) WITHOUT OIDS;



/* Create Foreign Keys */

ALTER TABLE EVENT_MEDIA
	ADD FOREIGN KEY (MEDIA_ID)
	REFERENCES EVENT (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE EVENT_MEDIA
	ADD FOREIGN KEY (EVENT_ID)
	REFERENCES MEDIA (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PANEL_MEDIA
	ADD FOREIGN KEY (MIDIA_ID)
	REFERENCES MEDIA (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CONFIG_GROUP_PANELS
	ADD FOREIGN KEY (MASTER_PANEL_ID)
	REFERENCES PANEL (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CONFIG_GROUP_PANELS
	ADD FOREIGN KEY (NORMAL_PANEL_ID)
	REFERENCES PANEL (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PANEL_MEDIA
	ADD FOREIGN KEY (PANEL_ID)
	REFERENCES PANEL (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE EVENT
	ADD FOREIGN KEY (PLACE_ID)
	REFERENCES PLACE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PANEL
	ADD FOREIGN KEY (PLACE_ID)
	REFERENCES PLACE (ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;



/* Comments */

COMMENT ON COLUMN CONFIG_GROUP_PANELS.MASTER_PANEL_ID IS 'id do painel agrupador dos eventos.';
COMMENT ON COLUMN CONFIG_GROUP_PANELS.NORMAL_PANEL_ID IS 'id do painel que será agrupado.';
COMMENT ON COLUMN MEDIA.CONTENT IS 'Quando se tratar de uma imagem será guardado o encode base 64';
COMMENT ON COLUMN PANEL.ADDRESS IS 'onde o painel está instalado. Pode ser uma sala, salão, corredor, etc.
';
COMMENT ON COLUMN PANEL.ENDOMARKETING_TIME IS 'tempo em segundos para exibição das midias associadas ao painel. ver configuração.';
COMMENT ON TABLE PLACE IS 'Entenda por area uma area, um corredor, um balcao, etc';
COMMENT ON COLUMN PLACE.NAME IS 'exemplo VENEZIA 1';



